/*global $,tutorialAnimationFinished, playerGo*/
var diceGameEvg=function(){function PlayerClass(e,i){this.color=e,this.side=i,this.pieces=[]}function PieceClass(){this.position=null,this.element=null}function randOrd(){return Math.round(Math.random())-.5}function getMyColor(){return 0===players.length?null:players[0].color}function scrollDialog(e,i){var o=$ch_outer.children("#"+e),t=o.position().left
0>t&&$ch_outer.children("#"+e).css("left","250px"),o.animate({left:"-=217px"},1e3,null,i)}function stopSelectPieceDlgAnimation(){null!==selectPieceDlgAnimationTimer&&(clearTimeout(selectPieceDlgAnimationTimer),selectPieceDlgAnimationTimer=null)}function startSelectPieceDlgAnimation(){stopSelectPieceDlgAnimation(),selectPieceDlgAnimationTimer=setTimeout(function(){var e="Red"
$selectPieceDlgTitle.hasClass("color-toggled")===!0&&(e="Gray"),$selectPieceDlgTitle.css("color",e).toggleClass("color-toggled"),startSelectPieceDlgAnimation()},500)}function setPieceHoverImage(e,i){var o,t
e.hasClass("p_white")?o=0:e.hasClass("p_red")?o=-25:e.hasClass("p_blue")?o=-50:e.hasClass("p_green")&&(o=-75),t=i?-25:0,e.css({backgroundPosition:o+"px "+t+"px"})}function getPieceColor(e){for(var i in aColors)if(e.hasClass(aColors[i]))return aColors[i]}function getPlayerIDByColor(e){for(var i in players)if(players[i].color===e)return parseInt(i,10)
return null}function rotateChessBoard(e,i){var o
switch(i){case"top":e.top=9-e.top,e.left=9-e.left
break
case"left":o=e.left,e.left=9-e.top,e.top=o
break
case"right":o=e.top,e.top=9-e.left,e.left=o}return e}function getPieceAbsolutePositionSquare(e,i){var o,t={top:null,left:null}
if(0>i)t.top=9,t.left=10+i
else if(7>i)t.top=8,t.left=8-i
else{if(i>=7&&29>i)return o=$.inArray(e,chessBoardSides),o+=Math.floor(i/7),o%=4,t=getPieceAbsolutePositionSquare(chessBoardSides[o],i%7)
i>=28&&(t.top=36-i,t.left=36-i)}return t=rotateChessBoard(t,e)}function getPieceAbsolutePositionPixel(e){return e.top=25*e.top,e.left=25*e.left,e}function bindPieceHover(e){e.hover(function(){$(this).addClass("hovered")},function(){$(this).removeClass("hovered")})}function placePiecesInitially(e,i,o){var t,n,l,r,s,a={top:0,left:0},c=$ch_outer,u=players[getPlayerIDByColor(getPieceColor(e))]
for(a.top=$(e).offset().top-c.offset().top,a.left=$(e).offset().left-c.offset().left,t=-1;t>-5;t-=1)n=$("<div class='piece'></div>").addClass(getPieceColor(e)),n.css("left",a.left+"px"),n.css("top",a.top+"px"),c.append(n),l=getPieceAbsolutePositionSquare(i,t),r=getPieceAbsolutePositionPixel(l),n.animate({left:r.left+"px",top:r.top+"px"},700,null,-4===t?o:null),s=new PieceClass,s.position=t,s.element=n[0],n.data("pieceIndex",u.pieces.length),u.pieces.push(s),i===chessBoardSides[0]&&bindPieceHover(n)}function setOpponentsDialog(){var e,i=aColors.slice(0)
for(i.sort(randOrd),i.splice($.inArray(getMyColor(),i),1),e=0;3>e;e+=1)$($ch_outer.find("#play3Opponents .piece")[e]).addClass(i[e])
for(i.sort(randOrd),i.pop(),e=0;2>e;e+=1)$($ch_outer.find("#play2Opponents .piece")[e]).addClass(i[e])
i=aColors.slice(0),i.splice($.inArray(getMyColor(),i),1),$($ch_outer.find("#play1Opponent .piece")[0]).addClass(i[Math.floor(3*Math.random())])}function getLowestPieceIndex(e){var i,o=null,t=100
for(i in e.pieces)e.pieces[i].position<t&&(o=i,t=e.pieces[i].position)
return o}function getPlayerForElement(e){return players[getPlayerIDByColor(getPieceColor($(e)))]}function getPieceForElement(e){return getPlayerForElement(e).pieces[$(e).data("pieceIndex")]}function bounceAnimate(elemetsToBounce,changeProperty,bounceAnimationSpeed,bounceAnimationTime,bounceAnimationShift,onFinished,additionalAnimation){(null===bounceAnimationSpeed||void 0===bounceAnimationSpeed)&&(bounceAnimationSpeed=100),(null===bounceAnimationShift||void 0===bounceAnimationShift)&&(bounceAnimationShift=3),(null===bounceAnimationTime||void 0===bounceAnimationTime)&&(bounceAnimationTime=1500),(null===changeProperty||void 0===changeProperty)&&(changeProperty="marginTop")
var properties=changeProperty.split(","),animationScript="elemetsToBounce",animationLoopCount=2*Math.floor(bounceAnimationTime/bounceAnimationSpeed/2),i,iProperty
for(i=0;animationLoopCount>i;i+=1){for(1===i&&(bounceAnimationShift*=2),i===animationLoopCount-1&&(bounceAnimationShift/=2),animationScript+=".animate({ ",iProperty=0;iProperty<properties.length;iProperty+=1)iProperty>0&&(animationScript+=","),animationScript+=properties[iProperty]+": '"+(i%2===0?"-":"+")+"="+bounceAnimationShift+"px' "
animationScript+="}, "+bounceAnimationSpeed,void 0!==onFinished&&i===animationLoopCount-1&&(animationScript+=",null,"+onFinished),animationScript+=")"}void 0!==additionalAnimation&&(animationScript+=additionalAnimation),eval(animationScript)}function movePieceAnimate(pieceVar,side,newPosition,onFinishFunction,bounceBeforeMove){var positionInBetween,moveDistance,absoluteSqPositionOld,absoluteSqPositionNew,animationTime,animationCode,bounceAnimationTime,absoluteSqPosition
return(void 0===pieceVar||void 0===side)&&(pieceVar=pieceToMoveQueue,side=getPlayerForElement(pieceVar.element).side,newPosition=positionToMoveQueue,onFinishFunction=$isTutorial===!0?tutorialAnimationFinished:playerGo),pieceVar.position>=0&&newPosition>=0&&Math.floor(pieceVar.position/7)!==Math.floor(newPosition/7)&&newPosition%7!==0?(positionInBetween=7*Math.floor(newPosition/7),void movePieceAnimate(pieceVar,side,positionInBetween,movePieceAnimate)):(moveDistance=newPosition-pieceVar.position,absoluteSqPositionOld=getPieceAbsolutePositionSquare(side,pieceVar.position),pieceVar.position=newPosition,absoluteSqPositionNew=getPieceAbsolutePositionSquare(side,pieceVar.position),0>newPosition&&(moveDistance=Math.sqrt(Math.pow(absoluteSqPositionOld.top-absoluteSqPositionNew.top,2)+Math.pow(absoluteSqPositionOld.left-absoluteSqPositionNew.left,2))),animationTime=Math.ceil(.6*(moveDistance+4)*100),absoluteSqPosition=getPieceAbsolutePositionPixel(absoluteSqPositionNew),animationCode=".animate({ left: '"+absoluteSqPosition.left+"px', top: '"+absoluteSqPosition.top+"px' }, "+animationTime+", null, null); ",$ch_outer.children(".piece").css("zIndex","10"),$(pieceVar.element).css("zIndex","50"),bounceBeforeMove===!0?(bounceAnimationTime=1e3,animationTime+=bounceAnimationTime,bounceAnimate($(pieceVar.element),null,null,bounceAnimationTime,null,null,animationCode)):(animationCode="$(pieceVar.element)"+animationCode,eval(animationCode)),void(void 0!==onFinishFunction&&setTimeout(onFinishFunction,animationTime-animationTime/4)))}function initDiceApp(){currentPlayerIndex=null,diceRollResultPredefined=null,$ch_outer.children(".piece").remove(),$diceDlg.animate({top:"-50px"},"300"),players=[],$ch_outer.find("#selectOpponentsDlg .piece").removeAttr("class").addClass("piece"),$ch_outer.find("#whoGoesFirstShow").html(""),$selectPieceDlgTitle=$("#selectPieceDlg .title",$ch_outer),whoGoesFirstResults=[],aCheckWhoFirstColors=null,piecesPositions=[],piecesCanMove=[],pieceToMoveQueue=null,positionToMoveQueue=null,$isTutorial=!1,scrollDialog("selectPieceDlg",startSelectPieceDlgAnimation)}function reminderDice(){bounceAnimate(diceToRoll)}function generateDiceRandomNumber(){var e=Math.floor(6*Math.random())+1;-1===$.inArray(e,diceNumbersHistory)?(2===diceNumbersHistory.length&&diceNumbersHistory.pop(),diceNumbersHistory.unshift(e),diceNumberThrown=e):generateDiceRandomNumber()}function rollDice(e,i,o){if(void 0!==e){if(diceToRoll=e,iRollDiceDelay=30+Math.floor(40*Math.random()),iDelayMax=100+Math.floor(100*Math.random()),$isTutorial===!0&&(diceRollResultPredefined=6,iDelayMax+=300),throwSpeed=1.1+Math.random()/5,diceRollFunction=i,diceNumbersHistory=[],o)return reminderDiceTimer=setInterval(reminderDice,5e3),void diceToRoll.removeAttr("class").addClass("dice").addClass("dice_q").addClass("hoverable").hover(function(){$(this).addClass("hovered")},function(){$(this).removeClass("hovered")}).one("click",function(){clearInterval(reminderDiceTimer),reminderDiceTimer=null,$(this).unbind("mouseenter mouseleave"),rollDice()})}else iRollDiceDelay*=throwSpeed
generateDiceRandomNumber(),diceToRoll.removeAttr("class").addClass("dice").addClass("dice_"+diceNumberThrown),iDelayMax>iRollDiceDelay?setTimeout(function(){rollDice()},iRollDiceDelay):(null!==diceRollResultPredefined&&diceToRoll.removeAttr("class").addClass("dice").addClass("dice_"+diceRollResultPredefined),setTimeout(diceRollFunction,0===currentPlayerIndex?0:1e3))}function tutorialChangeLink(e){$ch_outer.find("#linkNext").unbind("mouseenter mouseleave").html(e).hover(function(){$(this).html("→ "+e+" ←")},function(){$(this).html(e)})}function tutorialMoveToCorner(){var e=players[0]
getLowestPieceIndex(e)
pieceToMoveQueue=e.pieces[tutorialPieceMove],positionToMoveQueue=0,movePieceAnimate()}function scrollTutorialText(){$tutorialScrollAminationElement=$ch_outer.find("#tutorial"+tutorialPageNo),$tutorialScrollAminationElement.animate({marginTop:tutorialTextScrollAmount+"px"},50*Math.abs(tutorialTextScrollAmount),"linear")}function getTutorialPiece(e){var i=players[0]
return i.pieces[e]}function tutorialNewPage(){var e,i,o,t,n,l,r
if(tutorialPageNo+=1,null!==$tutorialScrollAminationElement&&($tutorialScrollAminationElement.stop(!1,!1),$tutorialScrollAminationElement=null),null!==tutorialScrollTimeout&&(clearTimeout(tutorialScrollTimeout),tutorialScrollTimeout=null),tutorialPageNo>1&&(e=-1===navigator.appVersion.indexOf("MSIE 7.")?!1:!0,e?$ch_outer.find("#tutorial"+(tutorialPageNo-1)).hide():$ch_outer.find("#tutorial"+(tutorialPageNo-1)).slideUp("normal")),6===tutorialPageNo)return tutorialPieceMove-=1,$ch_outer.find("#tutorialDlg").hide(),void tutorialMoveToCorner()
if(9===tutorialPageNo)return scrollDialog("tutorialDlg"),void initDiceApp()
if(i=$ch_outer.find("#tutorial"+tutorialPageNo),i.show(),o=i.height(),t=$ch_outer.find("#tutorialViewWinow").height(),o>t&&(tutorialTextScrollAmount=t-o,tutorialScrollTimeout=setTimeout(function(){scrollTutorialText()},2e3)),2===tutorialPageNo)for(n=0;2>n;n+=1)l=new PlayerClass,l.color=aColors[n],l.side=chessBoardSides[2*n],players.push(l),r=$ch_outer.find("#tutorialDlg .piece").removeAttr("class").addClass("piece").addClass(l.color),placePiecesInitially($(r),l.side)
3===tutorialPageNo&&($ch_outer.find("#linkNext").hide(),rollDice(i.children(".dice"),tutorialMoveToCorner,!1)),4===tutorialPageNo&&($ch_outer.find("#linkNext").hide(),pieceToMoveQueue=getTutorialPiece(tutorialPieceMove),positionToMoveQueue=5,movePieceAnimate()),5===tutorialPageNo&&tutorialChangeLink("Show Me"),7===tutorialPageNo&&($ch_outer.find("#tutorialDlg").show(),tutorialChangeLink("Next")),8===tutorialPageNo&&tutorialChangeLink("Start Game")}function startTutorial(){$ch_outer.find("#tutorial1").show(),tutorialPageNo=0,tutorialPieceMove=3,tutorialChangeLink("Next"),tutorialScrollTimeout=null,$ch_outer.find("#tutorialViewWinow > div").css("marginTop","0"),$isTutorial=!0,$tutorialScrollAminationElement=null,scrollDialog("tutorialDlg"),tutorialNewPage()}function tutorialAnimationFinished(){if(3===tutorialPageNo&&$ch_outer.find("#linkNext").show(),4===tutorialPageNo||6===tutorialPageNo){var e=28+tutorialPieceMove
e>positionToMoveQueue?(positionToMoveQueue+=Math.floor(3*Math.random())+4,positionToMoveQueue>e&&(positionToMoveQueue=e),movePieceAnimate()):4===tutorialPageNo?$ch_outer.find("#linkNext").show():tutorialPieceMove>0?(tutorialPieceMove-=1,tutorialMoveToCorner()):setTimeout(function(){tutorialNewPage()},3e3)}}function startGame(){players.length>0&&scrollDialog("whoGoesFirstDlg",playerGo)}function showGoesFirstDiceRoll(){whoGoesFirstResults.length>0?null===whoGoesFirstResults[whoGoesFirstResults.length-1].dice&&(whoGoesFirstResults[whoGoesFirstResults.length-1].dice=diceNumberThrown):$ch_outer.find("#whoGoesFirstShow").html("")
var e,i,o,t
if(0!==aCheckWhoFirstColors.length)o=$("<div class='whoGoesFirstPlayer'><div class='piece'></div><div class='dice'></div></div>"),o.children(".piece").addClass(aCheckWhoFirstColors[0]),$ch_outer.find("#whoGoesFirstShow").append(o),whoGoesFirstResults.push({color:aCheckWhoFirstColors[0],dice:null}),t=aCheckWhoFirstColors[0]===getMyColor(),aCheckWhoFirstColors.shift(),rollDice(o.children(".dice"),showGoesFirstDiceRoll,t)
else{for(whoGoesFirstResults.sort(function(e,i){return i.dice-e.dice}),e=whoGoesFirstResults.length,i=1;e>i;i+=1)whoGoesFirstResults[whoGoesFirstResults.length-1].dice<whoGoesFirstResults[0].dice&&whoGoesFirstResults.pop()
if(whoGoesFirstResults.length>1){for(i=0;i<whoGoesFirstResults.length;i+=1)aCheckWhoFirstColors.push(whoGoesFirstResults[i].color),bounceAnimate($ch_outer.find("#whoGoesFirstShow ."+whoGoesFirstResults[i].color),null,null,null,null,i===whoGoesFirstResults.length-1?showGoesFirstDiceRoll:null)
aCheckWhoFirstColors.sort(randOrd),whoGoesFirstResults=[]}else currentPlayerIndex=getPlayerIDByColor(whoGoesFirstResults[0].color),bounceAnimate($ch_outer.find("#whoGoesFirstShow ."+whoGoesFirstResults[0].color),null,null,null,null,startGame)}}function setWhoGoesFirstDialog(){aCheckWhoFirstColors=[]
var e
for(e=0;e<players.length;e+=1)aCheckWhoFirstColors.push(players[e].color)
aCheckWhoFirstColors.sort(randOrd),showGoesFirstDiceRoll()}function init(){null===$ch_outer&&($ch_outer=$("#ch_outer"),$diceDlg=$ch_outer.children("#diceDialog"),$dice=$diceDlg.children("div:first"),$ch_outer.find("#selectPeices .hoverable").hover(function(){setPieceHoverImage($(this),!0)},function(){setPieceHoverImage($(this),!1)}).click(function(){if(null===getMyColor()){stopSelectPieceDlgAnimation()
var e=new PlayerClass
e.color=getPieceColor($(this)),e.side="bottom",players.push(e),placePiecesInitially($(this),"bottom",function(){setOpponentsDialog(),scrollDialog("selectPieceDlg"),scrollDialog("selectOpponentsDlg")})}}),$ch_outer.find("#tutorialLink").click(function(){if(null===getMyColor()){var e=new PlayerClass
return e.color="p_white",e.side="bottom",players.push(e),scrollDialog("selectPieceDlg"),startTutorial(),!1}}),$ch_outer.find("#linkNext").click(function(){return tutorialNewPage(),!1}),$ch_outer.find("#play3Opponents, #play2Opponents, #play1Opponent").hover(function(){$(this).children(".piece").addClass("hoverable").each(function(){setPieceHoverImage($(this),!0)})},function(){$(this).children(".piece").removeClass("hoverable").each(function(){setPieceHoverImage($(this),!1)})}),$ch_outer.find("a.my_link").hover(function(){$(this).html("→ "+$(this).html()+" ←")},function(){var e=$(this).html()
$(this).html(e.substring(2,e.length-2))}),$ch_outer.find("#gameOverDlg a").click(function(){return scrollDialog("gameOverDlg"),initDiceApp(),!1}),initDiceApp(),$ch_outer.find("#selectOpponentsDlg > div").click(function(){if(!(players.length>1)){var e=$(this).children(".piece").length,i=0;(1===e||2===e&&Math.random()>.5)&&(i=1),$(this).children(".piece").each(function(o){var t=chessBoardSides[o+1+i],n=new PlayerClass
n.color=getPieceColor($(this)),n.side=t,players.push(n),placePiecesInitially($(this),t,o===e-1?function(){$ch_outer.children(".piece").css("zIndex","10"),scrollDialog("selectOpponentsDlg"),scrollDialog("whoGoesFirstDlg",setWhoGoesFirstDialog)}:null)})}}))}function AiClass(){function e(e,o,t){var n,l,r=players[currentPlayerIndex]
for(n=0;n<piecesCanMove.length;n+=1)if(l=piecesCanMove[n],e===l.position){void 0!==o&&(t=parseInt(i[r.color][o],10)),l.moveWeight+=Math.floor(t*Math.random())
break}}var i={p_green:{"new":10,capture:20,finish:90,save:60,new_limit:2},p_red:{"new":10,capture:90,finish:50,save:20,new_limit:3},p_white:{"new":60,capture:80,finish:90,save:20,new_limit:4},p_blue:{"new":10,capture:60,finish:80,save:50,new_limit:1}}
this.decideMove=function(){return this.collectPiecesData(),piecesCanMove.sort(function(e,i){return e.moveWeight!==i.moveWeight?i.moveWeight-e.moveWeight:Math.random()>.2?i.position-e.position:e.position-i.position}),piecesCanMove[0]},this.collectPiecesData=function(){var o,t,n,l,r,s,a,c,u,p,d=players[currentPlayerIndex],h=!1
for(o=0;o<piecesCanMove.length;o+=1){if(t=piecesCanMove[o],t.moveWeight=0,t.position<=0){if(n=0,t.position<0){for(l=0;l<d.pieces;l+=1)d.pieces[l].position>0&&d.pieces[l].position<29&&(n+=1)
n>=i[d.color].new_limit&&(e(t.position,null,-30),h=!0)}h||e(t.position,"new"),h=!0}if((t.position>=0&&void 0!==piecesPositions[t.position+diceNumberThrown]||t.position<0&&void 0!==piecesPositions[0])&&e(t.position,"capture"),t.position+diceNumberThrown>28&&e(t.position,"finish"),t.position>=0){for(a=t.position-1;a>=t.position-6;a-=1)if(r=a,0>a&&(r=28+a),null!==piecesPositions[r]&&void 0!==piecesPositions[r]){if(s=piecesPositions[r],s.player.color!==players[currentPlayerIndex].color){if((Math.floor(t.position/7)!==Math.floor(r/7)&&t.position%7!==0||r%7===0)&&s.piece.position>23)break
e(t.position,"save")}break}if(t.position>0&&t.position<28&&t.position%7===0)for(c=$.inArray(players[currentPlayerIndex].side,chessBoardSides),c+=Math.floor(t.position/7),c>3&&(c%=4),u=0;u<players.length;u+=1)if(p=players[u],p.side===chessBoardSides[c]&&p.pieces[getLowestPieceIndex(p)].position<0){e(t.position,"save")
break}}}}}function isMyTurn(){return 0===currentPlayerIndex}function PieceOnBoard(e,i){this.player=e,this.piece=i}function reminderAnimation(){var e,i,o=[]
for(e=0;e<piecesCanMove.length;e+=1)i=piecesCanMove[e],o.push(i.element)
bounceAnimate($(o))}function captureOpponnets(){if(void 0===piecesPositions[positionToMoveQueue])return movePieceAnimate(),6>diceNumberThrown&&(currentPlayerIndex+=1,currentPlayerIndex>players.length-1&&(currentPlayerIndex=0)),!1
var e=piecesPositions[positionToMoveQueue].piece,i=piecesPositions[positionToMoveQueue].player,o=i.pieces[getLowestPieceIndex(i)].position
return o>=0&&(o=0),o-=1,movePieceAnimate(e,i.side,o,movePieceAnimate,!0),!0}function movePiece(e){var i,o,t=players[currentPlayerIndex]
e.position<0?(i=getLowestPieceIndex(t),pieceToMoveQueue=t.pieces[i],positionToMoveQueue=0):(o=e.position+diceNumberThrown,pieceToMoveQueue=e,positionToMoveQueue=o),captureOpponnets()}function playerTurnDiceRolled(){piecesCanMove=[],piecesPositions=[]
var e,i,o,t,n,l,r,s,a,c,u,p,d
for(e=0;e<players.length;e+=1)for(i=players[e],o=0;o<i.pieces.length;o+=1)if(a=i.pieces[o],a.position>=0){if(t=a.position,e!==currentPlayerIndex){if(a.position>28)continue
n=$.inArray(players[currentPlayerIndex].side,chessBoardSides),l=$.inArray(i.side,chessBoardSides),n>l&&(l+=4),r=l-n,t=7*r+a.position,t>28&&(t-=28)}piecesPositions[t]=new PieceOnBoard(i,a),28===t?piecesPositions[0]=piecesPositions[t]:0===t&&(piecesPositions[28]=piecesPositions[t])}for(s=players[currentPlayerIndex],o=0;o<s.pieces.length;o+=1)if(a=s.pieces[o],a.position<0){if(6===diceNumberThrown&&(void 0===piecesPositions[0]||piecesPositions[0].player.color!==s.color)){piecesCanMove.push(a)
continue}}else{if(p=a.position+diceNumberThrown,p>31)continue
for(c=!1,u=a.position+1;p>u;u+=1)if(void 0!==piecesPositions[u]){c=!0
break}if(c)continue
if(void 0===piecesPositions[p]||piecesPositions[p].player.color!==s.color){piecesCanMove.push(a)
continue}}return 0===piecesCanMove.length?(setTimeout(playerGo,0===currentPlayerIndex?1e3:0),currentPlayerIndex+=1,void(currentPlayerIndex>players.length-1&&(currentPlayerIndex=0))):void(isMyTurn()?(reminderAnimationTimer=setInterval(reminderAnimation,5e3),$.each(piecesCanMove,function(){a=this,$(a.element).addClass("hoverable").hover(function(){setPieceHoverImage($(this),!0)},function(){setPieceHoverImage($(this),!1)}).one("click",function(){clearInterval(reminderAnimationTimer),reminderAnimationTimer=null,a=getPieceForElement(this),$ch_outer.children("."+players[0].color).removeClass("hoverable").css("cursor","").unbind("mouseenter mouseleave").unbind("click").each(function(){setPieceHoverImage($(this),!1),bindPieceHover($(this))}),movePiece(a)}),$(a.element).hasClass("hovered")&&(setPieceHoverImage($(a.element),$(a.element).hasClass("hovered")),$(a.element).css("cursor","pointer"))})):(d=new AiClass,movePiece(d.decideMove())))}function rollGameDice(){rollDice($dice,playerTurnDiceRolled,isMyTurn())}function checkWin(){var e,i,o,t,n,l=!1
return $.each(players,function(){for(i=this,l=!0,t=0;t<i.pieces.length;t+=1)o=i.pieces[t],o.position<28&&(l=!1)
return l===!0?(n=$ch_outer.find("#gameOverDlg"),currentPlayerIndex=e,bounceAnimate($ch_outer.children("."+i.color+":odd"),null,null,3e4),bounceAnimate($ch_outer.children("."+i.color+":even"),null,120,3e4),0===currentPlayerIndex?(n.children("#opponnetWins").hide(),n.children("#youWin").show()):(n.find("#opponnetWins > .piece").removeAttr("class").addClass("piece "+i.color),n.children("#opponnetWins").show(),n.children("#youWin").hide()),setTimeout(function(){scrollDialog("gameOverDlg")},3e3),!1):void 0}),l}function playerGo(){if(!checkWin()){var e,i,o={top:6,left:4}
switch(players[currentPlayerIndex].side){case"top":o.left=4,o.top=2
break
case"left":o.left=2,o.top=4
break
case"right":o.left=6,o.top=4}i=getPieceAbsolutePositionPixel(o),i.top+=5,i.left+=5,e=$diceDlg.position(),e.top===i.top&&e.left===i.left?rollGameDice():$diceDlg.animate({left:i.left+"px",top:i.top+"px"},400,null,rollGameDice)}}var aColors=["p_white","p_red","p_blue","p_green"],chessBoardSides=["bottom","left","top","right"],$ch_outer=null,$diceDlg=null,$dice=null,$isTutorial=!1,players=[],currentPlayerIndex=null,diceNumberThrown=0,aCheckWhoFirstColors=null,whoGoesFirstResults=[],iRollDiceDelay=null,iDelayMax=100,throwSpeed=1.15,diceToRoll=null,diceRollFunction=null,diceNumbersHistory=[],diceRollResultPredefined=null,reminderDiceTimer=null,piecesPositions=[],piecesCanMove=[],reminderAnimationTimer=null,pieceToMoveQueue=null,positionToMoveQueue=null,tutorialTextScrollAmount=0,tutorialScrollTimeout=null,$tutorialScrollAminationElement=null,tutorialPageNo=0,tutorialPieceMove=3,selectPieceDlgAnimationTimer=null,$selectPieceDlgTitle=null
return{init:init}}()
